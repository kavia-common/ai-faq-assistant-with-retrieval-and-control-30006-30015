{"is_source_file": true, "format": "TypeScript", "description": "Angular component for a chatbox interface connecting to an AI FAQ assistant. It manages user inputs, displays messages, filters FAQs and chat history, and responds to topic changes.", "external_files": ["../core/rag.service", "../core/topics-bridge.service", "./chatbox.component.html", "./chatbox.component.css"], "external_methods": ["this.rag.ask", "this.topicsBridge.topic$.subscribe"], "published": ["send", "clear"], "classes": [{"name": "ChatboxComponent", "description": "Main Angular component providing the chat interface for user-AI interaction, with filtering and topic management."}], "methods": [{"name": "private filterInput(raw: string): { cleaned: string | null; feedback?: string } { filterInput", "description": "Sanitizes and validates user input, masking banned words and stripping tags.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "private buildFilterDataset(): ChatMessage[] { buildFilterDataset", "description": "Prepares the dataset used for filtering, based on current chat messages.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "private computeFilteredHistory(query: string): ChatMessage[] { computeFilteredHistory", "description": "Filters chat messages based on the query and current topic.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "private computeFilteredFaqs(query: string): Array<{ title: string; content: string }> { computeFilteredFaqs", "description": "Filters FAQ entries based on the query and active topic.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "private resetFilterView() { resetFilterView", "description": "Resets filtering state to show the full conversation.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "async send() { send", "description": "Handles user message submission, filters input, updates conversation, and fetches AI response.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "clear() { clear", "description": "Clears the chat history and resets filters.", "scope": "ChatboxComponent", "scopeKind": "class"}, {"name": "constructor( constructor", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "ngOnDestroy(): void { ngOnDestroy", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}], "calls": ["this.rag.ask", "this.topicsBridge.topic$.subscribe", "console.error", "g.requestAnimationFrame", "g.setTimeout", "d.querySelector"], "search-terms": ["ChatboxComponent", "faqs", "topic", "filter", "send", "Angular", "Component", "AI FAQ"], "state": 2, "file_id": 30, "knowledge_revision": 100, "git_revision": "3a4de1abe7397d27c0266630834a6f169ebc2b77", "revision_history": [{"66": ""}, {"84": ""}, {"87": ""}, {"89": "7c498a08d76dbab3cffecb73c11abf1e6e8c58a0"}, {"92": "1fb407bc66403f3ee081ad3694da7f13a17f9a28"}, {"94": "3080606b07413b32d45f6c784d1bfb3d7628ce9d"}, {"97": "3080606b07413b32d45f6c784d1bfb3d7628ce9d"}, {"100": "3a4de1abe7397d27c0266630834a6f169ebc2b77"}], "ctags": [{"_type": "tag", "name": "ChatboxComponent", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^export class ChatboxComponent implements OnDestroy {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "activeTopic", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private activeTopic: string | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "buildFilterDataset", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private buildFilterDataset(): ChatMessage[] {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "cleaned", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const { cleaned, feedback } = this.filterInput(this.input);$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "clear", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  clear() {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "computeFilteredFaqs", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private computeFilteredFaqs(query: string): Array<{ title: string; content: string }> {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "computeFilteredHistory", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private computeFilteredHistory(query: string): ChatMessage[] {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  constructor($/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^          const d: any = (globalThis as any).document;$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^          const list = d && typeof d.querySelector === 'function' ? d.querySelector('.messages')/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const data = this.buildFilterDataset();$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredHistory", "scopeKind": "method"}, {"_type": "tag", "name": "errMsg", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^      const errMsg: ChatMessage = {$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "faqCatalog", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private faqCatalog: Record<string, Array<{ title: string; content: string }>> = {$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "faqs", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const faqs = this.faqCatalog[topicKey] || [];$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredFaqs", "scopeKind": "method"}, {"_type": "tag", "name": "feedback", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const { cleaned, feedback } = this.filterInput(this.input);$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "filterFeedback", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  filterFeedback: string | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "filterInput", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private filterInput(raw: string): { cleaned: string | null; feedback?: string } {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "filterMatches", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  filterMatches = false;$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "filteredFaqs", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  filteredFaqs: Array<{ title: string; content: string }> = [];$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "filteredMessages", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  filteredMessages: ChatMessage[] = [];$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "g", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^        const g: any = globalThis as any;$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "i", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^      const isContextNote = m.role === 'system' && \\/Context updated to topic\\/i.test(m.content)/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredHistory", "scopeKind": "method"}, {"_type": "tag", "name": "inTopic", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const inTopic = this.activeTopic;$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredHistory", "scopeKind": "method"}, {"_type": "tag", "name": "input", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  input = '';$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "isContextNote", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^      const isContextNote = m.role === 'system' && \\/Context updated to topic\\/i.test(m.content)/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredHistory", "scopeKind": "method"}, {"_type": "tag", "name": "lastQuery", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  lastQuery: string = '';$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^          const list = d && typeof d.querySelector === 'function' ? d.querySelector('.messages')/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  messages: ChatMessage[] = [$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "ngOnDestroy", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  ngOnDestroy(): void {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "platformId", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    @Inject(PLATFORM_ID) private platformId: Object$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "q", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const q = query.toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredFaqs", "scopeKind": "method"}, {"_type": "tag", "name": "q", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const q = query.toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredHistory", "scopeKind": "method"}, {"_type": "tag", "name": "raf", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^        const raf: (cb: () => void) => void =$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "rag", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    private rag: RagService,$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "resetFilterView", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private resetFilterView() {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "response", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^      const response = await this.rag.ask(this.lastQuery, { topic: this.activeTopic ?? undefined/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.send", "scopeKind": "method"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  async send() {$/", "language": "TypeScript", "kind": "method", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "sending", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  sending = false;$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^  private sub: any;$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}, {"_type": "tag", "name": "topicKey", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const faqs = this.faqCatalog[topicKey] || [];$/", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredFaqs", "scopeKind": "method"}, {"_type": "tag", "name": "topicKey", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    const topicKey = this.activeTopic && this.faqCatalog[this.activeTopic] ? this.activeTopic : /", "language": "TypeScript", "kind": "constant", "scope": "ChatboxComponent.computeFilteredFaqs", "scopeKind": "method"}, {"_type": "tag", "name": "topicsBridge", "path": "/home/kavia/workspace/code-generation/ai-faq-assistant-with-retrieval-and-control-30006-30015/faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "pattern": "/^    private topicsBridge: TopicsBridgeService,$/", "language": "TypeScript", "kind": "property", "scope": "ChatboxComponent", "scopeKind": "class"}], "hash": "97c7af00bace413471485e6b7555de35", "format-version": 4, "code-base-name": "faq_chatbox_frontend", "filename": "faq_chatbox_frontend/src/app/chat/chatbox.component.ts", "fields": [{"name": "private activeTopic: string | null = null;", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "private faqCatalog: Record<string, Array<{ title: string; content: string }>> = {", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "filterFeedback: string | null = null;", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "filterMatches = false;", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "filteredFaqs: Array<{ title: string; content: string }> = [];", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "filteredMessages: ChatMessage[] = [];", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "input = '';", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "lastQuery: string = '';", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "messages: ChatMessage[] = [", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "@Inject(PLATFORM_ID) private platformId: Object", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "private rag: RagService,", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "sending = false;", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "private sub: any;", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "private topicsBridge: TopicsBridgeService,", "scope": "ChatboxComponent", "scopeKind": "class", "description": "unavailable"}]}